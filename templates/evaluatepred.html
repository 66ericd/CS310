<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Evaluation Results (Predictions)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <nav class="navbar bg-dark border-bottom border-body" data-bs-theme="dark">
        <div class="container-fluid">
          <span class="navbar-brand mb-0 h1">CS310 Project</span>
        </div>
    </nav>
    <div class="container mt-5">
        <h1>Evaluation Results (Predictions)</h1>
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="alert alert-dark" role="alert">
          <ul>
            {% for message in messages %}
              <li>{{ message }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
        {% endwith %}
        {% for resultset in resultsets %}
          <div class="mb-4">
            <h2>{{ resultset[0] }}</h2>
            <ul class="nav nav-tabs" id="tabSet{{ loop.index }}" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="positive-tab-{{ loop.index }}" data-bs-toggle="tab" data-bs-target="#positive{{ loop.index }}" type="button" role="tab" aria-controls="positive{{ loop.index }}" aria-selected="true">Positive Outcomes</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="negative-tab-{{ loop.index }}" data-bs-toggle="tab" data-bs-target="#negative{{ loop.index }}" type="button" role="tab" aria-controls="negative{{ loop.index }}" aria-selected="false">Negative Outcomes</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="disparate-tab-{{ loop.index }}" data-bs-toggle="tab" data-bs-target="#disparate{{ loop.index }}" type="button" role="tab" aria-controls="disparate{{ loop.index }}" aria-selected="false">Disparate Impact Ratio</button>
              </li>
            </ul>

            <div class="tab-content mt-3" id="tabContent{{ loop.index }}">
              <div class="tab-pane fade show active" id="positive{{ loop.index }}" role="tabpanel" aria-labelledby="positive-tab-{{ loop.index }}">
                <canvas id="positiveImpactChart{{ loop.index }}" width="400" height="200"></canvas>
              </div>
              <div class="tab-pane fade" id="negative{{ loop.index }}" role="tabpanel" aria-labelledby="negative-tab-{{ loop.index }}">
                <canvas id="negativeImpactChart{{ loop.index }}" width="400" height="200"></canvas>
              </div>
              <div class="tab-pane fade" id="disparate{{ loop.index }}" role="tabpanel" aria-labelledby="disparate-tab-{{ loop.index }}">
                <canvas id="disparateImpactChart{{ loop.index }}" width="400" height="200"></canvas>
              </div>
            </div>
          </div>
        {% endfor %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        {% for resultset in resultsets %}
          const labels{{ loop.index }} = {{ resultset[1] | tojson }};
          const positiveData{{ loop.index }} = {{ resultset[2] | tojson }};
          const negativeData{{ loop.index }} = {{ resultset[3] | tojson }};
          const disparateData{{ loop.index }} = {{ resultset[4] | tojson }};
          
          new Chart(document.getElementById('positiveImpactChart{{ loop.index }}').getContext('2d'), {
            type: 'bar',
            data: {
              labels: labels{{ loop.index }},
              datasets: [{
                label: 'Positive Outcomes (%)',
                data: positiveData{{ loop.index }},
                backgroundColor: 'rgba(75, 192, 192, 0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });

          new Chart(document.getElementById('negativeImpactChart{{ loop.index }}').getContext('2d'), {
            type: 'bar',
            data: {
              labels: labels{{ loop.index }},
              datasets: [{
                label: 'Negative Outcomes (%)',
                data: negativeData{{ loop.index }},
                backgroundColor: 'rgba(255, 99, 132, 0.6)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });

          new Chart(document.getElementById('disparateImpactChart{{ loop.index }}').getContext('2d'), {
            type: 'bar',
            data: {
              labels: labels{{ loop.index }},
              datasets: [{
                label: 'Disparate Impact',
                data: disparateData{{ loop.index }},
                backgroundColor: 'rgba(153, 102, 255, 0.6)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        {% endfor %}
      });
    </script>
  </body>
</html>
